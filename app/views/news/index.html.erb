<% if not @news_items.empty? %>
    <% @news_item = @news_items[0] %>
    <%= render :partial => 'news/item', :locals => {:full => false} %>

    <div class="divider1"></div>

    <div id="primarycontainer">
      <div id="primarycontent">
        <% @news_items[1..-1].each_with_index do |news_item, i| %>
            <% if i > 0 %>
                <div class="divider2"></div>
            <% end %>
            <div class="post">
              <h4>
                <%= news_item.title %>
                <% if news_item.publication_state != NewsItem::PublicationState::PUBLISHED %>
                (<%= t news_item.publication_state.downcase %>)
                <% end %>
              </h4>

              <div class="contentarea">
                <div class="details">
                  <%= "Skrevet av #{news_item.creator.name}" if news_item.creator %>
                  <%= news_item.created_at.strftime '%Y-%m-%d' %>
                </div>
                <% texts = [news_item.summary, news_item.body].select { |text| !text.blank? } %>
                <%= textilize(texts[0].strip).html_safe if texts[0] %>
                <%= detour_to('Les mer...', news_item) if texts[1] %>

                <% if user? %>
                    <ul class="controls">
                      <li><%= detour_to 'Endre', edit_news_item_path(news_item), :class => :edit %></li>
                      <li><%= detour_to 'UtlÃ¸pt', {:controller => :news, :action => :expire, :id => news_item}, :class => :edit, :confirm => 'Er du sikker?', :method => :post %></li>
                      <li><%= detour_to 'Slett', {:controller => :news, :action => :destroy, :id => news_item}, :class => :edit, :confirm => 'Er du sikker?', :method => :delete %></li>
                    </ul>
                <% end %>
              </div>
            </div>
        <% end %>
      </div>
    </div>
<% end %>

<% if @link_to_news_archive %>
    <p>
    <ul class="controls">
      <li>
        <%= link_to 'Eldre nyheter', {:controller => :news, :action => :list, :id => nil}, :class => :edit %>
      </li>
    </ul>
    </p>
<% end %>

<%= javascript_tag do %>
    $('.post img').addClass('img-thumbnail');
    $('.post img').colorbox({
      title: function() { return $(this).attr('title') },
      href: function() { return $(this).attr('src').replace("inline", "show") },
      maxWidth: '100%',
      maxHeight: '100%',
    });
<% end %>
