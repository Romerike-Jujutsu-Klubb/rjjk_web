<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <meta name="description" content="description"/>
  <meta name="keywords" content="keywords"/>
  <meta name="author" content="author"/>
  <%= javascript_include_tag :application %>
  <%= csrf_meta_tags %>

  <link href="<%= url_for(:controller => 'stylesheets', :action => 'dark_ritual', :format => 'css', :id => @content_width) %>" media="screen" rel="stylesheet" type="text/css"/>
  <%= stylesheet_link_tag :application, :media => :all %>

  <title>Romerike Jujutsu Klubb</title>

  <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-20693372-1']);
      _gaq.push(['_trackPageview']);

      (function () {
          var ga = document.createElement('script');
          ga.type = 'text/javascript';
          ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
      })();
  </script>

</head>

<body>

<div class="container">

  <div class="header">
    Romerike Jujutsu Klubb<br/>

    <% if flash[:notice] || flash['notice'] %>
        <div style="width: 45% ; height: 3em ; background: white; margin-left: 1em ; border: 1px solid yellow; font-size: 10pt ; float: left">
          <%= flash[:notice] %>
          <%= flash['notice'].try(:html_safe) %>
        </div>
    <% end %>
    <span style="font-size: 10pt; text-align: center">
      <%= link_to 'Logg på NKF', 'http://nkfwww.kampsport.no/portal/page/portal/ks_utv/st_login', :onclick => 'return !window.open(this.href)', :style => 'margin-right: 50px' %>
      <%= link_to 'FaceBook', 'http://www.facebook.com/home.php#!/pages/Romerike-Jujutsu-Klubb/260684570923?ref=ts', :onclick => 'return !window.open(this.href)' %>
      <%= link_to 'Bli medlem!', 'http://nkfwww.kampsport.no/portal/page/portal/ks_utv/ks_bli_medlem?p_o3_pk_id=162', :onclick => 'return !window.open(this.href)' %>
	</span>
  </div>

  <div class="main_right">

    <div class="padded">
      <%= link_to image_tag('rjjk_logo_&_txt_320.png', :style => 'width: 182px; height: 181px; border: 0'), '/' %>

      <% if @image && !@image.new_record? && (controller.class != ImagesController || !%w{gallery mine}.include?(controller.action_name)) %>
          <div align="center">
            <%= link_to :controller => :images, :action => :gallery, :id => @image.id do %>
                <% if @image.video? %>
                    <%= video_tag url_for(:controller => :images, :action => :show, :id => @image.id, :format => @image.format), :title => @image.name || 'Film', :style => 'width: 100%; border: 0', :controls => true, :autobuffer => true %>
                <% else %>
                    <%= image_tag url_for(:controller => :images, :action => :inline, :id => @image.id, :width => 182, :format => @image.format), :title => @image.name || 'Bilde', :style => 'width: 100%; border: 0' %>
                <% end %>
                <%= @image.description %>
            <% end %>
            <ul class="controls" style="text-align: center">
              <li><%= link_to 'Godkjenn', {:controller => :images, :action => :update, :id => @image.id, :image => {:approved => true}}, :method => :put if admin? && !@image.approved? %></li>
              <li><%= link_to @image.public? ? 'Skjul' : 'Publiser', {:controller => :images, :action => :update, :id => @image.id, :image => {:public => !@image.public?}}, :method => :put if admin? %></li>
              <li><%= link_to 'Liker', {:controller => :user, :action => :like, :id => @image.id}, :method => :post if user? && !@image.likers.include?(current_user) %></li>
            </ul>
          </div>
      <% end %>

      <% if user? %>
          <h3 align="center">Last opp media</h3>
          <%= form_for @new_image do |f| %>
              <%= f.file_field :file, :onchange => 'form.submit()', :style => 'width: 100%; background: #89866F' %>
          <% end %>
          <br/>
      <% end %>

      <% if @events.any? %>
          <% last_year = Date.today.year %>
          <% last_mon = nil %>
          <div class="events">
          <h3>Hva skjer? <%=link_to image_tag('ical.png', :height => '24px'), :protocol => :webcal, :controller => :events, :action => :calendar, :format => :ics%></h3>

          <% for event in @events %>
              <% ingress = event.ingress %>
              <% ingress = nil if ingress.blank? %>
              <% body = event.body %>
                <% if event.start_at.year != last_year %>
                    <% last_year = event.start_at.year %>
                    <h4 style="color: #E20916"><%=last_year %></h4>
                <% end %>
                <% if event.start_at.mon != last_mon %>
                    <% last_mon = event.start_at.mon %>
                    <h4 style="color: #E20916"><%= t Date::MONTHNAMES[last_mon] %></h4>
                <% end %>
                <h4 style="color: #FFB400">
                  <% if event.end_at.nil? || event.end_at == event.start_at %>
                      <% if event.start_at.min != 0 || event.start_at.hour != 0 %>
                          <%= t(:date)[:day_names][event.start_at.wday]%> <%= event.start_at.strftime('%d. kl. %H:%M') %>
                      <% else %>
                          <%= t(:date)[:day_names][event.start_at.wday] %> <%= event.start_at.mday %>.
                      <% end %>
                  <% else %>
                      <% if event.end_at.to_date == event.start_at.to_date %>
                          <%= t(:date)[:day_names][event.start_at.wday]%> <%= event.start_at.mday %>.<br/>
                          kl. <%= event.start_at.strftime('%H:%M') %>-<%= event.end_at.strftime('%H:%M') %>
                      <% else %>
                          <% if event.start_at.min == 0 && event.start_at.hour == 0 && event.end_at.hour == 0 && event.end_at.min == 0 %>
                              <%= event.start_at.mday %>-<%=event.end_at.mday%>.
                          <% else %>
                              <%= t(:date)[:day_names][event.start_at.wday]%> <%= event.start_at.mday %>. <%= event.start_at.strftime('%H:%M') %>
                              -
                              <%= t(:date)[:day_names][event.end_at.wday] %>  <%=event.end_at.mday%>.     <%= event.end_at.strftime('%H:%M') %>
                          <% end %>
                      <% end %>
                  <% end %>
                </h4>

                <h4>
                <% if body %>
                    <%= link_to event.name, :controller => :events, :action => :show, :id => event.id %>
                <% else %>
                    <%= event.name %>
                <% end %>
                </h4>

                <% if ingress %>
                  <%= ingress.html_safe %>
              <% end %>
                <ul class="controls">
                  <% if ingress && event.description.size > ingress.size %>
                      <li><%= link_to 'Les mer', {:controller => :events, :action => :show, :id => event.id}, :class => :edit %></li>
                  <% end %>
                  <li><%= link_to 'Redigèr', {:controller => :events, :action => :edit, :id => event.id}, :class => :edit if admin? %></li>
                </ul>
          <% end %>
          </div>
      <% end %>

      <% if admin? %>
          <ul class="controls">
            <li><%= link_to 'Ny hendelse', {:controller => 'events', :action => 'new'}, :class => :edit %></li>
          </ul>
      <% end %>
      <br/>

      <% if admin? %>
          <% if Rails.env != 'development' %>
              <%= link_to image_tag(url_for(:controller => :members, :action => :history_graph, :format => :png, :id => 182), :title => 'Historikk graf', :style => 'width: 100%; border: 0'), :controller => :members, :action => :history_graph, :format => :png, :id => 1024 %>
              <%= link_to image_tag(url_for(:controller => :attendances, :action => :history_graph, :format => :png, :id => 182), :title => 'Oppmøte graf', :style => 'width: 100%; border: 0'), :controller => :attendances, :action => :history_graph, :format => :png, :id => 1024 %>
              <%= link_to image_tag(url_for(:controller => :members, :action => :grade_history_graph, :format => :png, :id => 182), :title => 'Historikk over grader', :style => 'width: 100%; border: 0'), :controller => :members, :action => :grade_history_graph, :format => :png, :id => 1024 %>
              <%= link_to image_tag(url_for(:controller => :members, :action => :grade_history_graph, :format => :png, :id => 182, :percentage => 67, :step => 30, :interval => 365), :title => 'Gjevnt oppmøte voksne per grad', :style => 'width: 100%; border: 0'), :controller => :members, :action => :grade_history_graph, :format => :png, :id => 800, :percentage => 67, :step => 61, :interval => 365 %>
          <% else %>
              <%= link_to 'Historikk graf', :controller => :members, :action => :history_graph, :format => :png, :id => 1024 %>
              <%= link_to 'Oppmøte graf', :controller => :attendances, :action => :history_graph, :format => :png, :id => 1024 %>
              <%= link_to 'Historikk over grader', :controller => :members, :action => :grade_history_graph, :format => :png, :id => 1024 %>
              <%= link_to 'Gjevnt oppmøte voksne', :controller => :members, :action => :grade_history_graph, :format => :png, :id => 800, :percentage => 67, :step => 30, :interval => 365 %>
          <% end %>
          <br/>
          <br/>
      <% end %>
    </div>

  </div>

  <div class="subnav">

    <ul>
      <li><%= link_to 'Forside', '/' %></li>
      <% if member? %>
          <li><%= link_to 'Min Embu', :controller => :embus, :action => :index %></li>
      <% end %>
      <% if user? %>
          <li><%= link_to 'Mine media', :controller => :images, :action => :mine %></li>
      <% end %>
    </ul>

    <h1>Oversikt</h1>
    <ul>
      <% @information_pages.each do |page| %>
          <li>
            <%= link_to page.title + (page.visible? ? '' : ' (skjult)'), :controller => :info, :action => :show, :id => page.title %>
            <%#=link_to 'ned', :controller => :info, :action => :move_down, :id => page.id%>
          </li>
      <% end %>

      <% if not user? %>
          <li><%= detour_to 'Logg inn', :controller => 'user', :action => :login %></li>
      <% else %>
          <li><%= detour_to 'Logg ut', :controller => 'user', :action => :logout %></li>
      <% end %>
    </ul>

    <% if admin? %>
        <h1>Administrasjon</h1>

        <div id="admin_menu">
          <ul>
            <li><%= link_to 'Ny nyhet', :controller => 'news', :action => 'new' %></li>
            <li><%= link_to 'Ny side', :controller => 'info', :action => 'new' %></li>
            <li><%= link_to 'Ny hendelse', :controller => 'events', :action => 'new' %></li>
            <li><%= link_to 'Brukere', :controller => 'user', :action => :list %></li>
          </ul>
        </div>

        <h1>Medlemsreg.</h1>

        <div id="members_menu">
          <ul>
            <li><%= menu_item 'Medlemsliste', :controller => 'members', :action => :list_active %></li>
            <li><%= menu_item 'Oppmøtelister', :controller => 'members', :action => :attendance_form_index %></li>
            <li><%= menu_item 'Graderinger', :controller => 'graduations' %></li>
            <li><%= menu_item 'Telefonliste', :controller => 'members', :action => :telephone_list %></li>
            <li><%= menu_item 'E-postlister', :controller => 'members', :action => :email_list %></li>
            <li><%= menu_item 'Gamle medlemmer', :controller => 'members', :action => :list_inactive %></li>
            <li><%= menu_item 'Instruksjon', :controller => 'group_instructors' %></li>
            <li><%= menu_item 'Bursdager', :controller => 'birthday_celebrations' %></li>
            <li><%= menu_item 'Treninger', :controller => 'group_schedules' %></li>
            <li><%= menu_item 'Grupper', :controller => 'groups' %></li>
            <li><%= menu_item 'Grader', :controller => 'ranks' %></li>
            <li><%= menu_item 'Stiler', :controller => 'martial_arts' %></li>
            <!--
			<li><%= menu_item 'Inntekt', :controller => 'members', :action => :income %></li>
			<li><%= menu_item 'NKF Rapport', :controller => 'members', :action => :NKF_report %></li>
			<li><%= menu_item 'CMS-Kontrakter', :controller => 'cms_members', :action => :active_contracts %></li>
			<li><%= menu_item 'CMS Avstemming', :controller => 'members', :action => :cms_comparison %></li>
			<li><%= menu_item 'NKF Medlemsliste', :controller => 'nkf_members', :action => :index %></li>
			-->
            <li><%= menu_item 'NKF Avstemming', :controller => 'nkf_members', :action => :comparison %></li>
            <li><%= menu_item 'Versjon', :controller => 'info', :action => :versjon %></li>
          </ul>
        </div>
    <% end %>

    <!--
            <h1>Third and last</h1>
            <ul>
                <li><a href="index.html">sociis natoque</a></li>
                <li><a href="index.html">magna sed purus</a></li>
                <li><a href="index.html">tincidunt</a></li>
                <li><a href="index.html">consequat molestie</a></li>
            </ul>
    -->

  </div>

  <div class="main">

    <div class="padded">
      <%= yield %>
    </div>

  </div>

  <div class="clearer"><span></span></div>

  <div class="footer">

    <span class="left">&copy; 2008-2012 <a href="http://jujutsu.no/">Romerike Jujutsu
      Klubb</a>. Valid <a href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a> &amp; <a href="http://validator.w3.org/check?uri=referer">XHTML</a></span>

    <span class="right">Template design by <a href="http://templates.arcsin.se">Arcsin</a></span>

    <div class="clearer"><span></span></div>

  </div>

</div>

</body>

</html>
