<% @content_width = 880 %>

<a class="carousel-control left" style="position: inherit; margin-top: -0.05em" href="<%= url_for :year => (@first_date - 1).year, :month => (@first_date - 1).month %>">&lsaquo;</a>
<a class="carousel-control right" style="position: inherit; margin-top: -0.05em" href="<%=url_for :year => (@last_date + 1).year, :month => (@last_date + 1).month%>">&rsaquo;</a>
<h2>Oppmøterapport <%= t(:date)[:month_names][@first_date.month] %> <%= @first_date.year %></h2>

<div id="myCarousel" class="carousel slide" data-interval="false">
  <!-- Carousel items -->
  <div class="carousel-inner">
    <div class="active item">
      <%= image_tag url_for(:controller => :attendances, :action => :month_chart, :year => @year, :month => @month, :size => '832x300', :format => :png),
                    :title => 'Oppmøte graf', :class => 'img-rounded', :style => 'width: 832px; height: 300px',
                    :usemap => '#monthmap' %>
    </div>
    <div class="item">
      <%= image_tag url_for(:controller => :attendances, :action => :month_per_year_chart, :month => @month, :size => '832x300', :format => :png),
                    :title => 'Oppmøte graf', :class => 'img-rounded', :style => 'width: 832px; height: 300px',
                    :usemap => '#monthmap' %>
    </div>
    <div class="item">
      <%= image_tag url_for(:controller => :attendances, :action => :history_graph, :id => '832x300', :format => :png),
                    :title => 'Oppmøte graf', :class => 'img-rounded', :style => 'width: 832px; height: 300px',
                    :usemap => '#monthmap' %>
    </div>
  </div>
  <!-- Carousel nav -->
  <a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
  <a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
</div>

<style>
    .carousel .carousel-control {
        visibility: hidden;
    }

    .carousel:hover .carousel-control {
        visibility: visible;
    }
</style>

<map name="monthmap">
  <!--
  <area shape="circle" coords="90,58,3" href="mercur.htm" alt="Mercury">
  <area shape="circle" coords="124,58,8" href="venus.htm" alt="Venus">
  -->
</map>

<table class="table">
  <% @monthly_summary_per_group.each do |g, stats| %>
      <tr>
        <th><%= g.name %></th>
        <td><%= stats[:present].size %></td>
        <td>Gjennomsnittlig <%= stats[:present].empty? ? 0 : (stats[:present].size.to_f / stats[:practices]).round %>
          deltakere på <%= stats[:practices] %> treninger
        </td>
      </tr>
  <% end %>
</table>

<h3>Antall deltakere</h3>

<table class="table">
  <tr>
    <th></th>
    <th style="text-align:center">Totalt</th>
    <th style="text-align:center">Tilstede +50%</th>
    <th style="text-align:center">Tilstede +67%</th>
  </tr>
  <% @by_group_and_member.each do |group, members| %>
      <tr>
        <th><%= group.name %></th>
        <td style="text-align:center"><%= members.select { |m, ats| true }.size %></td>
        <td style="text-align:center"><%= members.select { |m, ats| ats.size >= @monthly_summary_per_group[group][:practices] * 0.5 }.size %></td>
        <td style="text-align:center"><%= members.select { |m, ats| ats.size >= @monthly_summary_per_group[group][:practices] * 0.67 }.size %></td>
      </tr>
  <% end %>
</table>
