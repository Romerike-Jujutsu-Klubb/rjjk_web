- @content_width = 1024

a.btn.btn-warning.float-right href=sync_with_nkf_nkf_members_path data-method=:post
  i.fa.fa-sync.mr-2 class=('fa-spin' if NkfSynchronizationJob.mon_locked?)
  | Synkronis√©r med NKF
javascript:
  setInterval(function() {
    $.get('#{sync_progress_nkf_members_path}', function(data, textStatus, xhr) {
      if (xhr.status === 200) {
        $('.fa-sync').addClass('fa-spin');
      } else if ($('.fa-sync').hasClass('fa-spin')) {
        $('.fa-sync').removeClass('fa-spin');
        console.log("Sync completed!");
        window.location.reload();
      }
    }).fail(function(jqXHR, textStatus, errorThrown) {
      if (jqXHR.status === 404 && $('.fa-sync').hasClass('fa-spin')) {
        $('.fa-sync').removeClass('fa-spin');
        console.log("Sync completed!");
      }
    })
  }, 4000);

h1 NKF Synchronization errors (#{@errors.inject(0){|a,e| a + e[1].size}})

- left_errors, current_errors = @errors.partition{|row| row[0]&.left?}

- if left_errors.any?
  nav
    #nav-tab.nav.nav-tabs role="tablist"
      a#nav-home-tab.nav-item.nav-link.active data-toggle="tab" data-target="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true"
        | Medlemmer (#{current_errors.size})
      a#nav-profile-tab.nav-item.nav-link data-toggle="tab" data-target="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false"
        | Utmeldte (#{left_errors.size})

#nav-tabContent.tab-content
  #nav-home.tab-pane.fade.show.active role="tabpanel" aria-labelledby="nav-home-tab"
    = render 'sync_table', errors: current_errors
  - if left_errors.any?
    #nav-profile.tab-pane.fade role="tabpanel" aria-labelledby="nav-profile-tab"
      = render 'sync_table', errors: left_errors
